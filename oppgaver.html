<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon oppgaver</title>
</head>
<body>
   
    <h1>Pokemon oppgaver</h1>
    <input type="text" placeholder="name" id="card-name-txt" />
    <input type="text" placeholder="name" id="card-type-txt" />
    <input type="button" value="Lag pokemonkort" id="card-add-btn" />
    <select id="pokemon-filter-selection">
        <option value="all">Fjern filtrering/Vis alle</option>
        <option value="bug">Bug</option>
        <option value="dark">Dark</option>
        <option value="dragon">Dragon</option>
        <option value="electric">Electric</option>
        <option value="fairy">Fairy</option>
        <option value="fighting">Fighting</option>
        <option value="fire">Fire</option>
        <option value="flying">Flying</option>
        <option value="ghost">Ghost</option>
        <option value="grass">Grass</option>
        <option value="ground">Ground</option>
        <option value="normal">Normal</option>
        <option value="ice">Ice</option>
        <option value="poison">Poison</option>
        <option value="psychic">Psychic</option>
        <option value="rock">Rock</option>
        <option value="steel">Steel</option>
        <option value="water">Water</option>
    </select>
    <button class="filter-btn">Filtrer etter type</button><br><br>
    <div class="pokemon-container"></div>

    <script>
        const pokemonContainer = document.querySelector(".pokemon-container");
        const cardNameTxt = document.querySelector("#card-name-txt");
        const cardTypeTxt = document.querySelector("#card-type-txt");
        const cardAddBtn = document.querySelector("#card-add-btn")
        const filterBtn = document.querySelector(".filter-btn");
        let pokemonsId = [];
        let pokemonImageNameTypeOnly = [];

        let addPokemonCardSaved = JSON.parse(localStorage.getItem("addPokemonCardSaved")) || [];

        const correctType = ["bug", "dragon", "dark", "fairy", "electric", "fighting", "fire", "flying", "ghost", "grass", "ground", "normal", "ice", "poison", "psychic", "rock", "steel", "water"];

        async function fetchPokemon(id) {
            const pokemonRequest = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}/`);
            let response = await pokemonRequest.json();
            return response;
        }

        async function fetchAndShowPokemonId() {
            try {
                pokemonsId = [];
                for (let i = 1; i < 100; i += 2) {
                    idOfPokemon = await fetchPokemon(i);
                    pokemonsId.push(idOfPokemon);
                }
                pokemonImageNameTypeOnly = pokemonsId.map((pokemon) => ({
                    name:pokemon.name,
                    image:  pokemon.sprites.other[`official-artwork`].front_default,
                    type: pokemon.types[0].type.name,
                }));
                console.log("hvor mange", pokemonImageNameTypeOnly);
                showAllPokemon(pokemonImageNameTypeOnly);
            } catch (error) {
                console.error("Her klarte vi dessverre ikke å laste inn pokemons", error)
            }
        } 
       
        filterBtn.onclick = getFilterValue;

        function getFilterValue() {
            const selectedType = document.querySelector("#pokemon-filter-selection").value;
            filterPokemon(selectedType);
        }

        function filterPokemon(selectedType) {
            const filteredPokemon = pokemonImageNameTypeOnly;
            let typeFilter;

            if (selectedType === "all" ) {
                console.log("Viser alle pokemon", filteredPokemon);
                showAllPokemon(filteredPokemon);
        } else {
            typeFilter = filteredPokemon.filter((pokemon) => pokemon.types[0].type.name === selectedType);
            console.log("filter", typeFilter);
            
         if (typeFilter.length === 0) {
            console.log("hey");
            pokemonContainer.innerHTML = "" + "<h2>Ingen pokemons hadde denne type, sry</h2>";
            return;
        } else {
            showAllPokemon(typeFilter);
        }
    }}
    fetchAndShowPokemonId()

        function showAllPokemon(pokemons) {
            pokemonContainer.innerHTML = "";
            pokemons.forEach((pokemon, index) => {
                const pokemonCard = document.createElement("div");
                pokemonContainer.style.display ="flex";
                pokemonContainer.style.flexWrap = "wrap"
                pokemonContainer.style.gap = "10px";
                pokemonCard.style.width ="200px";
                pokemonCard.style.height ="280px";
                pokemonCard.style.padding ="10px";
                pokemonCard.style.backgroundColor = 

                pokemon.type == "water" 
                ? "#1451E3"
                : pokemon.type == "ice"
                ? "#83D1F2"
                : pokemon.type == "fighting"
                ? "#983F24"
                : pokemon.type == "fairy"
                ? "#951843"
                : pokemon.type == "ground"
                ? "#A96D2C"
                : pokemon.type == "steel"
                ? "#60736C"
                : pokemon.type == "rock"
                ? "#47170C"
                : pokemon.type == "grass"
                ? "#12793C"
                : pokemon.type == "electric"
                ? "#E2E22A"
                : pokemon.type == "dragon"
                ? "#418B94"
                : pokemon.type == "ghost"
                ? "#A22967"
                : pokemon.type == "psychic"
                ? "#A22967"
                : pokemon.type == "poison"
                ? "#5A2D85"
                : pokemon.type == "flying"
                ? "#49667C"
                : pokemon.type == "bug"
                ? "#183D21"
                : pokemon.type == "fire"
                ? "#AA1E21"
                : pokemon.type == "normal"
                ? "#73525B"
                : pokemon.type == "dark"
                ? "#040603"
                
                :"white";
                pokemonCard.innerHTML = `<img src="${pokemon.image}" style ="width: 200px" /> <h3>Navn: ${pokemon.name} <br> Type: ${pokemon.type}</h3>`;

                pokemonContainer.appendChild(pokemonCard);
                
            });
        }

        function addPokemonCard() {
            if (cardNameTxt.value === "" || cardTypeTxt.value === "") {
                alert("Du må fylle ut begge feltene");
                cardNameTxt.value = "";
                cardTypeTxt.value = "";
                return;
            }

            const userWrittenType = cardTypeTxt.value.toLowerCase();
            if(!correctType.includes(userWrittenType)) {
                alert("Skrivefeil? Her må du skrive en gyldig type")
                cardNameTxt.value = "";
                cardTypeTxt.value = "";
                return;
            }
             
            const diyPokemonCard = {
                name: cardNameTxt.value,
                type: cardTypeTxt.value.toLowerCase(),
                image: `./assets/pokemonBall.jpg`,
            };
            pokemonImageNameTypeOnly.unshift(diyPokemonCard);
            console.log("Ny pokemon", diyPokemonCard);
            console.log("hele array", pokemonImageNameTypeOnly);
            showAllPokemon(pokemonImageNameTypeOnly);

            addPokemonCardSaved.push(diyPokemonCard);
            localStorage.setItem("Mine lagde kort", JSON.stringify(addPokemonCardSaved));


        }

        cardAddBtn.addEventListener("click", addPokemonCard);

        

    </script>
    
</body>
</html>